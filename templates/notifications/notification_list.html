{% extends 'base.html' %}

{% block title %}Notifications - USIU LMS{% endblock %}

{% block content %}
<div style="max-width: 1000px; margin: 0 auto;">
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <div>
                <h1 style="margin-bottom: 0.5rem;">= Notifications</h1>
                <p style="color: #7f8c8d;">
                    {% if unread_count > 0 %}
                        You have <strong>{{ unread_count }}</strong> unread notification{{ unread_count|pluralize }}
                    {% else %}
                        No unread notifications
                    {% endif %}
                </p>
            </div>
            {% if unread_count > 0 %}
            <form method="post" action="{% url 'mark_all_notifications_read' %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit"
                        style="padding: 0.75rem 1.5rem; background-color: #3498db; color: white; border: none; border-radius: 4px; font-weight: 500; cursor: pointer;">
                    Mark All as Read
                </button>
            </form>
            {% endif %}
        </div>

        <!-- Filters -->
        <div style="background-color: #f8f9fa; padding: 1rem; border-radius: 4px; margin-bottom: 1.5rem;">
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <a href="{% url 'notification_list' %}"
                   style="padding: 0.5rem 1rem; background-color: {% if not request.GET.status %}#2c3e50{% else %}white{% endif %}; color: {% if not request.GET.status %}white{% else %}#2c3e50{% endif %}; text-decoration: none; border-radius: 4px; border: 1px solid #ddd;">
                    All
                </a>
                <a href="?status=unread"
                   style="padding: 0.5rem 1rem; background-color: {% if request.GET.status == 'unread' %}#2c3e50{% else %}white{% endif %}; color: {% if request.GET.status == 'unread' %}white{% else %}#2c3e50{% endif %}; text-decoration: none; border-radius: 4px; border: 1px solid #ddd;">
                    Unread
                </a>
                <a href="?status=read"
                   style="padding: 0.5rem 1rem; background-color: {% if request.GET.status == 'read' %}#2c3e50{% else %}white{% endif %}; color: {% if request.GET.status == 'read' %}white{% else %}#2c3e50{% endif %}; text-decoration: none; border-radius: 4px; border: 1px solid #ddd;">
                    Read
                </a>
            </div>
        </div>

        <!-- Notifications List -->
        {% if notifications %}
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                {% for notification in notifications %}
                <div class="card" style="{% if not notification.is_read %}background-color: #f0f8ff; border-left: 4px solid #3498db;{% endif %}">
                    <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem;">
                        <div style="font-size: 1.5rem;">{{ notification.get_icon }}</div>
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                <span style="font-weight: 600; color: #2c3e50;">{{ notification.title }}</span>
                                {% if not notification.is_read %}
                                <span style="background-color: #e74c3c; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem;">New</span>
                                {% endif %}
                            </div>
                            <p style="color: #555; margin-bottom: 0.5rem; font-size: 0.9375rem;">
                                {{ notification.message }}
                            </p>
                            <div style="display: flex; gap: 1rem; font-size: 0.875rem; color: #7f8c8d;">
                                <span>Date: {{ notification.created_at|date:"M d, Y H:i" }}</span>
                                {% if notification.related_course %}
                                <span>Course: {{ notification.related_course.code }}</span>
                                {% endif %}
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            {% if not notification.is_read %}
                            <a href="{% url 'mark_notification_read' notification.id %}"
                               style="padding: 0.5rem 1rem; background-color: #2ecc71; color: white; text-decoration: none; border-radius: 4px; font-size: 0.875rem; text-align: center; white-space: nowrap;">
                                View
                            </a>
                            {% else %}
                                {% if notification.action_url %}
                                <a href="{{ notification.action_url }}"
                                   style="padding: 0.5rem 1rem; background-color: #3498db; color: white; text-decoration: none; border-radius: 4px; font-size: 0.875rem; text-align: center; white-space: nowrap;">
                                    View
                                </a>
                                {% endif %}
                            {% endif %}
                            <form method="post" action="{% url 'delete_notification' notification.id %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit"
                                        style="width: 100%; padding: 0.5rem 1rem; background-color: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.875rem;">
                                    Delete
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            {% if notifications|length > 0 and request.GET.status != 'unread' %}
            <div style="margin-top: 1.5rem; border-top: 1px solid #e0e0e0; padding-top: 1rem;">
                <form method="post" action="{% url 'clear_all_notifications' %}" style="text-align: center;">
                    {% csrf_token %}
                    <button type="submit"
                            onclick="return confirm('Are you sure you want to clear all read notifications?')"
                            style="padding: 0.75rem 1.5rem; background-color: #e74c3c; color: white; border: none; border-radius: 4px; font-weight: 500; cursor: pointer;">
                        Clear All Read Notifications
                    </button>
                </form>
            </div>
            {% endif %}
        {% else %}
            <div style="text-align: center; padding: 3rem; color: #7f8c8d;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">=</div>
                <p style="font-size: 1.125rem;">No notifications yet</p>
                <p style="font-size: 0.875rem; margin-top: 0.5rem;">You're all caught up!</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
