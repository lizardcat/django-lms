{% extends 'base.html' %}

{% block title %}Announcements - {{ course.code }} - USIU LMS{% endblock %}

{% block content %}
<div style="max-width: 1000px; margin: 0 auto;">
    <div style="margin-bottom: 1rem;">
        <a href="{% url 'course_detail' course.id %}" style="color: #3498db; text-decoration: none;">&larr; Back to Course</a>
    </div>

    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <div>
                <h1 style="margin-bottom: 0.5rem;">Announcements</h1>
                <p style="color: #7f8c8d;">{{ course.code }} - {{ course.title }}</p>
            </div>
            {% if is_instructor %}
            <a href="{% url 'create_announcement' course.id %}"
               style="padding: 0.75rem 1.5rem; background-color: #2ecc71; color: white; text-decoration: none; border-radius: 4px; font-weight: 500;">
                + New Announcement
            </a>
            {% endif %}
        </div>

        <!-- Filters -->
        <form method="get" style="background-color: #f8f9fa; padding: 1rem; border-radius: 4px; margin-bottom: 1.5rem;">
            <div style="display: flex; gap: 1rem; align-items: end;">
                <div style="flex: 1;">
                    <label style="display: block; font-weight: 500; margin-bottom: 0.25rem;">Priority</label>
                    {{ filter_form.priority }}
                </div>
                <div style="display: flex; align-items: center;">
                    {{ filter_form.pinned_only }}
                    <label for="{{ filter_form.pinned_only.id_for_label }}" style="margin-left: 0.5rem;">
                        {{ filter_form.pinned_only.label }}
                    </label>
                </div>
                <button type="submit" style="padding: 0.5rem 1.5rem; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    Apply Filters
                </button>
                <a href="{% url 'course_announcements' course.id %}" style="padding: 0.5rem 1rem; background-color: #95a5a6; color: white; text-decoration: none; border-radius: 4px;">
                    Clear
                </a>
            </div>
        </form>

        <!-- Announcements List -->
        {% if announcements %}
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                {% for announcement in announcements %}
                <div class="card" style="border-left: 4px solid {{ announcement.get_priority_color }}; {% if announcement.pinned %}background-color: #fffbea;{% endif %}">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                {% if announcement.pinned %}
                                <span style="font-size: 1.25rem; color: #e74c3c;">&#128204;</span>
                                {% endif %}
                                <a href="{% url 'announcement_detail' announcement.id %}"
                                   style="font-size: 1.125rem; font-weight: 600; color: #2c3e50; text-decoration: none;">
                                    {{ announcement.title }}
                                </a>
                                {% if not is_instructor and not announcement.is_read %}
                                <span style="background-color: #e74c3c; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem;">New</span>
                                {% endif %}
                            </div>
                            <p style="color: #555; margin-bottom: 0.75rem;">
                                {{ announcement.content|truncatewords:30 }}
                            </p>
                            <div style="display: flex; gap: 1.5rem; font-size: 0.875rem; color: #7f8c8d;">
                                <span>By: {{ announcement.author.get_full_name|default:announcement.author.username }}</span>
                                <span>Date: {{ announcement.created_at|date:"M d, Y H:i" }}</span>
                                <span style="background-color: {{ announcement.get_priority_color }}; color: white; padding: 2px 8px; border-radius: 3px; font-size: 0.75rem;">
                                    {{ announcement.get_priority_display }}
                                </span>
                            </div>
                        </div>
                        {% if is_instructor %}
                        <div style="display: flex; gap: 0.5rem; margin-left: 1rem;">
                            <a href="{% url 'edit_announcement' announcement.id %}"
                               style="padding: 0.5rem 1rem; background-color: #f39c12; color: white; text-decoration: none; border-radius: 4px; font-size: 0.875rem;">
                                Edit
                            </a>
                            <a href="{% url 'delete_announcement' announcement.id %}"
                               style="padding: 0.5rem 1rem; background-color: #e74c3c; color: white; text-decoration: none; border-radius: 4px; font-size: 0.875rem;">
                                Delete
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="text-align: center; padding: 3rem; color: #7f8c8d;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">&#128226;</div>
                <p style="font-size: 1.125rem;">No announcements yet</p>
                {% if is_instructor %}
                <p style="font-size: 0.875rem; margin-top: 0.5rem;">Create your first announcement to notify students!</p>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
