{% extends 'base.html' %}

{% block title %}AI Teaching Assistant - USIU LMS{% endblock %}

{% block content %}
<div class="content-wrapper">
    <div class="page-header">
        <h1>ü§ñ AI Teaching Assistant</h1>
        <p class="text-secondary">AI-powered tools to enhance your teaching</p>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <!-- Quick Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üìö</div>
            <div class="stat-info">
                <div class="stat-value">{{ courses.count }}</div>
                <div class="stat-label">Your Courses</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ü§ñ</div>
            <div class="stat-info">
                <div class="stat-value">{{ recent_interactions.count }}</div>
                <div class="stat-label">AI Interactions</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-info">
                <div class="stat-value">Active</div>
                <div class="stat-label">AI Status</div>
            </div>
        </div>
    </div>

    <!-- AI Tools -->
    <div class="tools-section">
        <h2 class="section-title">üõ†Ô∏è AI Tools</h2>

        <div class="tools-grid">
            <!-- Grading Assistant -->
            <div class="tool-card">
                <div class="tool-icon">üìù</div>
                <div class="tool-content">
                    <h3 class="tool-title">AI Grading Assistant</h3>
                    <p class="tool-description">
                        Get AI-powered grading suggestions with confidence scores and detailed feedback
                        for student submissions.
                    </p>
                    <div class="tool-features">
                        <span class="feature-tag">Auto-grading</span>
                        <span class="feature-tag">Feedback Generation</span>
                        <span class="feature-tag">Consistency</span>
                    </div>
                </div>
                <div class="tool-actions">
                    {% if courses %}
                        <select id="gradingCourseSelect" class="course-select" onchange="navigateToGrading(this.value)">
                            <option value="">Select a course...</option>
                            {% for course in courses %}
                                <option value="{{ course.id }}">{{ course.title }}</option>
                            {% endfor %}
                        </select>
                    {% else %}
                        <p class="text-muted">No published courses available</p>
                    {% endif %}
                </div>
            </div>

            <!-- Student Analytics -->
            <div class="tool-card">
                <div class="tool-icon">üìä</div>
                <div class="tool-content">
                    <h3 class="tool-title">Student Analytics</h3>
                    <p class="tool-description">
                        AI-powered insights into student performance, learning gaps, and personalized
                        recommendations for struggling students.
                    </p>
                    <div class="tool-features">
                        <span class="feature-tag">Performance Tracking</span>
                        <span class="feature-tag">Gap Analysis</span>
                        <span class="feature-tag">Recommendations</span>
                    </div>
                </div>
                <div class="tool-actions">
                    {% if courses %}
                        <select id="analyticsCourseSelect" class="course-select" onchange="navigateToAnalytics(this.value)">
                            <option value="">Select a course...</option>
                            {% for course in courses %}
                                <option value="{{ course.id }}">{{ course.title }}</option>
                            {% endfor %}
                        </select>
                    {% else %}
                        <p class="text-muted">No published courses available</p>
                    {% endif %}
                </div>
            </div>

            <!-- Quiz Generation (Coming Soon) -->
            <div class="tool-card disabled">
                <div class="tool-icon">‚ùì</div>
                <div class="tool-content">
                    <h3 class="tool-title">AI Quiz Generator <span class="coming-soon-badge">Coming Soon</span></h3>
                    <p class="tool-description">
                        Automatically generate quiz questions based on course content with varying
                        difficulty levels and question types.
                    </p>
                    <div class="tool-features">
                        <span class="feature-tag">Auto-generation</span>
                        <span class="feature-tag">Multiple Types</span>
                        <span class="feature-tag">Difficulty Levels</span>
                    </div>
                </div>
            </div>

            <!-- Content Suggestions (Coming Soon) -->
            <div class="tool-card disabled">
                <div class="tool-icon">üí°</div>
                <div class="tool-content">
                    <h3 class="tool-title">Content Suggestions <span class="coming-soon-badge">Coming Soon</span></h3>
                    <p class="tool-description">
                        Get AI-generated suggestions for course improvements, additional resources,
                        and teaching strategies based on student performance.
                    </p>
                    <div class="tool-features">
                        <span class="feature-tag">Resource Suggestions</span>
                        <span class="feature-tag">Teaching Tips</span>
                        <span class="feature-tag">Course Optimization</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent AI Activity -->
    {% if recent_interactions %}
        <div class="activity-section">
            <h2 class="section-title">üìú Recent AI Activity</h2>
            <div class="activity-list">
                {% for interaction in recent_interactions|slice:":10" %}
                    <div class="activity-item">
                        <div class="activity-icon">
                            {% if interaction.interaction_type == 'GRADING' %}
                                üìù
                            {% elif interaction.interaction_type == 'QUIZ_HELP' %}
                                ‚ùì
                            {% elif interaction.interaction_type == 'ANALYTICS' %}
                                üìä
                            {% else %}
                                ü§ñ
                            {% endif %}
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">{{ interaction.get_interaction_type_display }}</div>
                            <div class="activity-meta">
                                {% if interaction.course %}
                                    <span>{{ interaction.course.title }}</span>
                                    <span class="separator">‚Ä¢</span>
                                {% endif %}
                                <span>{{ interaction.created_at|timesince }} ago</span>
                            </div>
                        </div>
                        {% if interaction.tokens_used %}
                            <div class="activity-tokens">
                                {{ interaction.tokens_used }} tokens
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
</div>

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
}

.stat-card {
    background: var(--bg-elevated);
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    box-shadow: var(--shadow-sm);
}

.stat-icon {
    font-size: 36px;
}

.stat-info {
    flex: 1;
}

.stat-value {
    font-size: 28px;
    font-weight: 700;
    color: var(--text-primary);
}

.stat-label {
    font-size: 12px;
    color: var(--text-secondary);
    text-transform: uppercase;
    font-weight: 500;
}

.tools-section, .activity-section {
    background: var(--bg-elevated);
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: var(--shadow-sm);
}

.section-title {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 20px;
}

.tools-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 20px;
}

.tool-card {
    background: var(--bg-primary);
    border: 2px solid var(--border-color);
    border-radius: 12px;
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    transition: all 0.2s;
}

.tool-card:not(.disabled):hover {
    border-color: var(--accent-primary);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.tool-card.disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.tool-icon {
    font-size: 48px;
}

.tool-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.coming-soon-badge {
    font-size: 10px;
    background: var(--accent-warning);
    color: var(--text-primary);
    padding: 2px 8px;
    border-radius: 12px;
    font-weight: 600;
    text-transform: uppercase;
}

.tool-description {
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.5;
}

.tool-features {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.feature-tag {
    font-size: 11px;
    background: var(--bg-secondary);
    padding: 4px 10px;
    border-radius: 12px;
    color: var(--text-secondary);
    font-weight: 500;
}

.tool-actions {
    margin-top: auto;
}

.course-select {
    width: 100%;
    padding: 10px 14px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background: var(--bg-elevated);
    color: var(--text-primary);
    font-size: 14px;
    cursor: pointer;
}

.course-select:focus {
    outline: none;
    border-color: var(--accent-primary);
}

.text-muted {
    font-size: 13px;
    color: var(--text-secondary);
    font-style: italic;
}

.activity-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.activity-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
}

.activity-icon {
    font-size: 28px;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-secondary);
    border-radius: 8px;
}

.activity-content {
    flex: 1;
}

.activity-title {
    font-weight: 500;
    margin-bottom: 4px;
}

.activity-meta {
    font-size: 12px;
    color: var(--text-secondary);
}

.separator {
    margin: 0 6px;
}

.activity-tokens {
    font-size: 12px;
    color: var(--text-secondary);
    background: var(--bg-secondary);
    padding: 4px 10px;
    border-radius: 12px;
}

.alert {
    padding: 12px 16px;
    border-radius: 8px;
    margin-bottom: 16px;
}

.alert-success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.alert-error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.text-secondary {
    color: var(--text-secondary);
}
</style>

<script>
function navigateToGrading(courseId) {
    if (courseId) {
        window.location.href = `/ai/grading/${courseId}/`;
    }
}

function navigateToAnalytics(courseId) {
    if (courseId) {
        window.location.href = `/ai/analytics/${courseId}/`;
    }
}
</script>
{% endblock %}
